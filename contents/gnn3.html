<!DOCTYPE html>
<html>
    <head>
        <title>GCN을 이용한 COLLAB TUDataset 그래프 분류</title>
        <meta name="description" content="GCN을 이용하여 그래프를 분류합니다.">
        <meta charset="utf-8">
        <link rel="stylesheet" href="init/index.css">
        <link rel="stylesheet" href="init/contents.css">
        <link rel="stylesheet" href="init/index_img/icons/css/fontello.css">

        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Dongle:wght@300&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">

        <link rel="stylesheet"
            href="init/highlight/styles/github-dark.min.css">
        <script src="init/highlight/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script src="init/highlight/highlights_line.js"></script>
        <script>initNumber(window, document);</script>
        <script>hljs.initLineNumbersOnLoad();</script>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="init/index.js"></script>
        <script src="init/jquery.pjax.js"></script>
        
        <meta name="viewport" content="width=device-width, initial-scale=0.8, max-width=1">

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-219110982-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-219110982-1');
        </script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7745178886614102"
        crossorigin="anonymous"></script>

        <meta property="og:url" content="https://ljm565.github.io/contents/gnn3.html" />
        <meta property="og:title" content="GCN을 이용한 COLLAB TUDataset 그래프 분류" />
        <meta property="og:type" content="website">
        <meta property="og:description" content="GCN을 이용하여 그래프를 분류합니다." />
        <meta property="og:image" content="https://lh3.googleusercontent.com/fife/AMPSemfAIlO91-AOZeuZkPgARkThsWqfcFq-Y6kDl5CXdKnYdF56UqEGytLISh2kXPF8q2k-pswKpAYovHaySOHVLbRCP-b1Fk89ArMyDt-yuejupC5kJEaZDyg18dBH7DQgkqi9NTFnVPubBSmKznR3fUKWLRwA__HtOO56SR8HtdS0FDjK3KEhP9RybTRd-fe9xb2PWOYold30eD_YmVFrybLmDqZbk6XzglX46egMZI6TTa41NsFIJqW8a0s5GU9I-QNuL0Xuj0vOC7jcLL_wxl_RJzf27Ar-mioLNlyXdL_zlTwVAuoN0uV2_Sy83uAIwRAJ_j5SeN5mAA9PvWOlVLoaGNfqgzUWLXBNxyzUE3uC7o2KWtzRXlw-0bHbSJDj1_JNTufpGNzDi46GotF_B3f-O4IihwS6pU0_x8kB_ccOkIW0v6PT0sSc-XWaaBYmAs5Qdgj6gXQSpBu2_n05QhosupE0yAxvFpjSKsxHSlBVxlrtpyCtLKX3aUG5by0q7XhNzlr6-j3Q0y9pZ24e1T7E52_4OSWpQmUQl74Zu64up_gHFn8rN49E0NwBxgF3D-01mnEsnU5aMDz01sJyfqgpIxrFpnTEch_5kMw_BnzoaPUFP3D-yMjOu3Nv9Ca7AGc_pVNAPhmt2GNxIVQYwilRrcvP5cH2c22NqqBzobcwV_HUmUAtZrsofuPR_f-cHsfb3DTXYWKgh4C2HrMlitbko6DzBF-CjULiPTKJpt2OATYN1fGSQAJl2BGN9i3ZJhLzA_YlH4UAsa84VtGAFRqRVSRjozLEekLUr1j_pb8PsloLJ0T_5J0AbeBsMmr_I36jNQtLEuQv6m9PiciaRvPLSBXo0769iSZPI-RXx5ODR5S1mL2wzOFflA_-f_fEhol0HhCAQWDq6H-8fK2a6OMMpUlg6P-ElRWA8-KaRff-wGrtMNt9xvp-b5Q_3MWbiwD4TF67lWxkQVwl8ZYKCTmEJF6l6wLHRKv_L7IIls1lL9aVhvmK_V9lwhVgkI3KfhlzndPkhEpV-s_lTnYY-HTSyhk39W0_PhIV5H1hAv3GabT-4PuyZl4yBzAMHHwukk1VGVxzDOQkVVvwZJoR416mBB-z1kZZ7Xhwq5yAmfYBmEm2U2toiFAZgA90rfwDuuZgt6SumX8XNN-OZh1LPOpS11Rs65X0T-3SOchgibzjFryBNEbzy2HzJvIK73FfAeGqNlfRYGp7eX4cSBttwq8zZwz2PEkKmGX5yBeyIg-0qCOK-EyBFeqITG4I7SK5PUe9o2fE_w_jEoEex-DQQf900PtN9DsOxuo9MywHXjjilxsKr5grKEo-JSR0C3LpmZUv7HsgGaMHp0rEJWOgpf6M4Tbe59ywUJydKzUDFRKp65w2oSuT7zhEG9P9qlw7UmzuNCzt9Z1cpYYczbG6qN6TRUI40gXm56wJHrR48tLr6XrZBJisbLMD_jdu_CIWgfaG7X_Tw76eV1hREmqlYWw" />
    </head>   
    <body>
        <div id="modeButton">
            <button type="button" value="dark" onclick="darkMode(this)" onmouseover="hoveringOn(this)" onmouseout="hoveringOff(this)">
                <div class="modeImg"><img id="modeImg" src="init/index_img/moon_off.png"></div>
                <div id="modeState">다크 모드로 보기</div>
            </button>
        </div>

        <div id="container" onclick="reload();">
            <article>
                <script src="init/highlight/highlight.min.js"></script>
                <script>hljs.highlightAll();</script>
                <script src="init/highlight/highlights_line.js"></script>
                <script>initNumber(window, document);</script>
                <script>hljs.initLineNumbersOnLoad();</script>
                <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
                <script>
                    initMathJax();
                </script>
                <div id="mainHeadWrapper">
                    <div id="mainHead">
                        <h1 class="contentHead">딥러닝 이야기 / Graph Neural Network (GNN), Graph Convolutional Network (GCN) / 3. GCN을 이용한 COLLAB TUDataset 그래프 분류</h1>
                    </div>
                </div>
                
                <div class="title" style="background-image:url(https://lh3.googleusercontent.com/fife/AMPSemfAIlO91-AOZeuZkPgARkThsWqfcFq-Y6kDl5CXdKnYdF56UqEGytLISh2kXPF8q2k-pswKpAYovHaySOHVLbRCP-b1Fk89ArMyDt-yuejupC5kJEaZDyg18dBH7DQgkqi9NTFnVPubBSmKznR3fUKWLRwA__HtOO56SR8HtdS0FDjK3KEhP9RybTRd-fe9xb2PWOYold30eD_YmVFrybLmDqZbk6XzglX46egMZI6TTa41NsFIJqW8a0s5GU9I-QNuL0Xuj0vOC7jcLL_wxl_RJzf27Ar-mioLNlyXdL_zlTwVAuoN0uV2_Sy83uAIwRAJ_j5SeN5mAA9PvWOlVLoaGNfqgzUWLXBNxyzUE3uC7o2KWtzRXlw-0bHbSJDj1_JNTufpGNzDi46GotF_B3f-O4IihwS6pU0_x8kB_ccOkIW0v6PT0sSc-XWaaBYmAs5Qdgj6gXQSpBu2_n05QhosupE0yAxvFpjSKsxHSlBVxlrtpyCtLKX3aUG5by0q7XhNzlr6-j3Q0y9pZ24e1T7E52_4OSWpQmUQl74Zu64up_gHFn8rN49E0NwBxgF3D-01mnEsnU5aMDz01sJyfqgpIxrFpnTEch_5kMw_BnzoaPUFP3D-yMjOu3Nv9Ca7AGc_pVNAPhmt2GNxIVQYwilRrcvP5cH2c22NqqBzobcwV_HUmUAtZrsofuPR_f-cHsfb3DTXYWKgh4C2HrMlitbko6DzBF-CjULiPTKJpt2OATYN1fGSQAJl2BGN9i3ZJhLzA_YlH4UAsa84VtGAFRqRVSRjozLEekLUr1j_pb8PsloLJ0T_5J0AbeBsMmr_I36jNQtLEuQv6m9PiciaRvPLSBXo0769iSZPI-RXx5ODR5S1mL2wzOFflA_-f_fEhol0HhCAQWDq6H-8fK2a6OMMpUlg6P-ElRWA8-KaRff-wGrtMNt9xvp-b5Q_3MWbiwD4TF67lWxkQVwl8ZYKCTmEJF6l6wLHRKv_L7IIls1lL9aVhvmK_V9lwhVgkI3KfhlzndPkhEpV-s_lTnYY-HTSyhk39W0_PhIV5H1hAv3GabT-4PuyZl4yBzAMHHwukk1VGVxzDOQkVVvwZJoR416mBB-z1kZZ7Xhwq5yAmfYBmEm2U2toiFAZgA90rfwDuuZgt6SumX8XNN-OZh1LPOpS11Rs65X0T-3SOchgibzjFryBNEbzy2HzJvIK73FfAeGqNlfRYGp7eX4cSBttwq8zZwz2PEkKmGX5yBeyIg-0qCOK-EyBFeqITG4I7SK5PUe9o2fE_w_jEoEex-DQQf900PtN9DsOxuo9MywHXjjilxsKr5grKEo-JSR0C3LpmZUv7HsgGaMHp0rEJWOgpf6M4Tbe59ywUJydKzUDFRKp65w2oSuT7zhEG9P9qlw7UmzuNCzt9Z1cpYYczbG6qN6TRUI40gXm56wJHrR48tLr6XrZBJisbLMD_jdu_CIWgfaG7X_Tw76eV1hREmqlYWw);">
                    <div>
                        <span class="mainTitle">GCN을 이용한 COLLAB TUDataset 그래프 분류</span>
                        <br><br>
                        <div style="display: table-cell; margin: 0;">
                            <img src="init/index_img/profile.png" style="width: 30px; cursor: pointer;" onclick="pjaxPage('/');">
                        </div>
                        <span class="subTitle" style="display: table-cell; text-align: left; vertical-align: middle; padding-left: 20px; line-height: 125%;">작성자: 여행 초짜<br>작성일: 2023.02.16</span>
                    </div>
                </div>

                <div id="content">
                    <p>
                        시작하기 앞서 틀린 부분이 있을 수 있으니, 틀린 부분이 있다면 지적해주시면 감사하겠습니다.
                        
                        <br><br><a onclick="pjaxPage('gnn2.html');"><span class="highlight" style="color: rgb(0, 3, 206);">이전글</span></a>에서는 Graph Convolutional Network (GCN)을 활용하여 그래프 node의 label을 예측하는 코드를 PyTorch Geometric 등의 library를 사용하지 않고 PyTorch로 naive하게 구성해보았습니다.
                        <span class="highlight" style="color: rgb(0, 3, 206);">하지만 이는 이전글에서 사용한 데이터는 Cora 데이터로 큰 데이터가 아니기에 가능했었습니다.
                        다만 이번에 다룰 TUDataset의 COLLAB 데이터는 큰 데이터기 때문에 batch 학습이 필요합니다.
                        따라서 이번에는 PyTorch Geometric이라는 library를 사용하여 코드를 구성해보겠습니다.</span>

                        <br><br>학습에 사용한 데이터는 TUDataset의 COLLAB 그래프 데이터이며, 이번에는 node 분류를 하는 것이 아닌 graph를 분류해보겠습니다.
                        그리고 마지막으로 GCN으로 학습된 각 그래프들의 feature를 t-SNE로 가시화합니다.
                        데이터에 대한 설명은 아래와 같습니다.
                        <ul>
                            <li><b>개요</b>: TUDataset의 COLLAB 그래프 데이터는 연구자들의 협업 현황을 나타낸 그래프들입니다.</li>
                            <li><b>Node</b>: <span class="highlight" style="color: rgb(0, 3, 206);">그래프의 node는 한 명의 연구자를 의미합니다.</span></li>
                            <li><b>Edge</b>: <span class="highlight" style="color: rgb(0, 3, 206);">Node끼리 연결된 edge는 연구자들끼리의 협업 현황을 의미합니다.</span></li>
                            <li><b>Label</b>: 연구자들의 협업을 나타내는 그래프가 총 5,000개 있으며, 각각의 연구 필드를 나타내는 3가지의 label이 부여되어있습니다..</li>
                            <li><b>Node feature</b>: 기본으로 제공되는 node feature가 없어 직접 만들어서 사용해야 합니다.</li>
                        </ul>
                        
                        <br><br>오늘의 컨텐츠입니다.
                        <ol>
                            <li>학습을 위한 데이터 구성</li>
                            <li>GCN 모델 구성</li>
                            <li>GCN 학습</li>
                            <li>학습 결과 및 특징 가시화</li>
                        </ol>
                    </p>
                    <div class="link">
                        <a href="https://github.com/ljm565/graph-classification-GCN" target="_blank" onmouseover="colorOn(this);" onmouseout="colorOff(this);">그래프 분류 GitHub 코드</a>
                    </div>
                    <p>
                        <br>그리고 TUDataset의 COLLAB 데이터를 사용했다고 했는데, TUDataset은 여러 그래프 데이터를 모아놓은 dataset입니다.
                        TUDatasset 목록 링크와 TUDataset의 논문 링크를 아래 달아두겠습니다.
                    </p>
                    <div class="link">
                        <a href="https://chrsmrrs.github.io/datasets/docs/datasets/" target="_blank" onmouseover="colorOn(this);" onmouseout="colorOff(this);">TUDataset 데이터 목록</a>
                    </div><br>
                    <div class="link">
                        <a href="https://arxiv.org/pdf/2007.08663.pdf" target="_blank" onmouseover="colorOn(this);" onmouseout="colorOff(this);">TUDataset 논문 링크</a>
                    </div>


                    <h1 class="subHead">Graph 분류를 위한 GCN 학습</h1>
                    <div class="doubleSubHead">
                        <span style="display: block; text-align: center;">&ldquo;</span>
                        <span>학습을 위한 데이터 구성</span><br>
                        <span style="display: block; text-align: center; margin-top: 13px;">&rdquo;</span>
                    </div>
                    <p>
                        COLLAB은 node feature가 기본으로 없기때문에 직접 제작해주어야 합니다.
                        그리고 제작한 그래프 데이터를 PyTorch Geometric Dataloader로 만드는 과정을 거칩니다.
                    </p>
<pre><code class="python"><span class="return">import</span> <span class="clazz">torch_geometric</span>.<span class="clazz">transforms</span> <span class="return">as</span> <span class="clazz">T</span>
<span class="return">from</span> <span class="clazz">torch_geometric</span>.<span class="clazz">utils</span> <span class="return">import</span> <span class="method">degree</span>
<span class="return">from</span> <span class="clazz">torch_geometric</span>.<span class="clazz">loader</span> <span class="return">import</span> <span class="clazz">DataLoader</span>
<span class="return">from</span> <span class="clazz">torch_geometric</span>.<span class="clazz">datasets</span> <span class="return">import</span> <span class="clazz">TUDataset</span>


<span class="reserved">def</span> <span class="method">load_data</span>(<span class="var">base_path</span>):
    <span class="clazz">torch</span>.<span class="method">manual_seed</span>(<span class="num">999</span>)
    <span class="var">dataset</span> = <span class="clazz">TUDataset</span>(<span class="var">root</span>=<span class="var">base_path</span> + <span class="str">'data/'</span>, <span class="var">name</span>=<span class="str">'COLLAB'</span>)
    <span class="var">dataset</span>.<span class="var">transform</span> = <span class="method">make_onehot_node_feature</span>(<span class="var">dataset</span>)
    <span class="var">dataset</span> = <span class="var">dataset</span>.<span class="method">shuffle</span>()
    <span class="return">return</span> <span class="var">dataset</span>


<span class="reserved">def</span> <span class="method">make_onehot_node_feature</span>(<span class="var">dataset</span>):
    <span class="var">max_degree</span> = <span class="num">0</span>                     
    <span class="return">for</span> <span class="var">data</span> <span class="return">in</span> <span class="var">dataset</span>:
        <span class="var">M_deg</span> = <span class="method">degree</span>(<span class="var">data</span>.edge_index[<span class="num">0</span>], <span class="var">dtype</span>=<span class="clazz">torch</span>.<span class="var">long</span>).<span class="method"><span class="method">max</span></span>().<span class="var">item</span>()
        <span class="var">max_degree</span> = <span class="method">max</span>(<span class="var">max_degree</span>, <span class="var">M_deg</span>)

    <span class="return">return</span> <span class="clazz">T</span>.<span class="clazz">OneHotDegree</span>(<span class="var">max_degree</span>)


<span class="annot"># load dataset</span>
<span class="var">dataset</span> = <span class="method">load_data</span>(<span class="str">'/'</span>)

<span class="annot"># split dataset</span>
<span class="var">train_len</span> = <span class="clazz">int</span>(<span class="method">len</span>(<span class="var">dataset</span>) * <span class="num">0.7</span>)
<span class="var">val_len</span> = <span class="clazz">int</span>(<span class="method">len</span>(<span class="var">dataset</span>) * <span class="num">0.15</span>)

<span class="var">dataset</span> = {
    <span class="str">'train'</span>: <span class="var">dataset</span>[:<span class="var">train_len</span>],
    <span class="str">'val'</span>: <span class="var">dataset</span>[<span class="var">train_len</span>:<span class="var">train_len</span>+<span class="var">val_len</span>],
    <span class="str">'test'</span>: <span class="var">dataset</span>[<span class="var">train_len</span>+<span class="var">val_len</span>:]
    }
<span class="var">dataloaders</span> = {
    <span class="var">s</span>: <span class="clazz">DataLoader</span>(<span class="var">d</span>, <span class="var">batch_size</span>, <span class="method">shuffle</span>=<span class="reserved">True</span>) <span class="return">if</span> <span class="var">s</span> == <span class="str">'train'</span> <span class="return">else</span> <span class="clazz">DataLoader</span>(<span class="var">d</span>, <span class="var"><span class="var">batch</span>_size</span>, <span class="method">shuffle</span>=<span class="reserved">False</span>)
    <span class="return">for</span> <span class="var">s</span>, <span class="var">d</span> <span class="return">in</span> <span class="var">dataset</span>.<span class="method">items</span>()}
</code></pre>
                    <p>
                        <ul>
                            <li>7 ~ 12번째 줄: TUDataset COLLAB 데이터 로드 부분.</li>
                            <li>10번째 줄: 15 ~ 21번째 줄 node feature를 만드는 부분을 거침.</li>
                            <li>17 ~ 19번째 줄: <span class="highlight" style="color: rgb(0, 3, 206);">5,000개의 그래프를 돌면서 각 노드별로 edge가 몇개 있는지 파악한 후, 모든 그래프에서 노드 당 가장 edge 개수가 많은 숫자를 찾음.</span></li>
                            <li>21번째 줄: 노드별로 edge의 개수에 해당하는 부분을 1로 채우는 one-hot encoding을 자동으로 하게 함(<span class="highlight" style="color: rgb(0, 3, 206);">e.g. 0, 1번 노드가 각각 최대 4개 edge 중에 3개, 1개의 edge를 가지고 있다면 [[0, 0, 0, 1, 0], [0, 1, 0, 0, 0]]로 구성</span>).</li>
                            <li>25번째 줄: Node feature를 포함한 최종 그래프 데이터 로드.</li>
                            <li>28 ~ 38번째 줄: 그래프 데이터를 dataloader로 구성.</li>
                        </ul>
                    </p>



                    <div class="doubleSubHead">
                        <span style="display: block; text-align: center; margin-top: 150px;">&ldquo;</span>
                        <span>GCN 모델 구성</span><br>
                        <span style="display: block; text-align: center; margin-top: 13px;">&rdquo;</span>
                    </div>
                    <p>
                        여기서는 학습에 사용할 GCN 모듈과 모델을 구성하는 코드입니다.
                </p>
<pre><code class="python"><span class="return">import</span> <span class="clazz">torch</span>.<span class="clazz">nn</span> <span class="return">as</span> <span class="clazz">nn</span>
<span class="return">from</span> <span class="clazz">torch_geometric</span>.<span class="clazz">nn</span> <span class="return">import</span> <span class="clazz">GCNConv</span>, <span class="method">global_mean_pool</span>



<span class="reserved">class</span> <span class="clazz">GCN</span>(<span class="clazz">nn</span>.<span class="clazz">Module</span>):
    <span class="reserved">def</span> <span class="method">__init__</span>(<span class="var">self</span>, <span class="var">config</span>, <span class="var">num_node_features</span>, <span class="var">cls_num</span>):
        <span class="clazz">super</span>(<span class="clazz">GCN</span>, <span class="var">self</span>).<span class="method">__init__</span>()
        <span class="var">self</span>.<span class="var">hidden_dim</span> = <span class="var">config</span>.<span class="var">hidden_dim</span>
        <span class="var">self</span>.<span class="var">dropout</span> = <span class="var">config</span>.<span class="var">dropout</span>
        <span class="var">self</span>.<span class="var">num_node_features</span> = <span class="var">num_node_features</span>
        <span class="var">self</span>.<span class="var">cls_num</span> = <span class="var">cls_num</span>

        <span class="var">self</span>.<span class="var">gcn1</span> = <span class="clazz">GCNConv</span>(<span class="var">self</span>.<span class="var">num_node_features</span>, <span class="var">self</span>.<span class="var">hidden_dim</span>)
        <span class="var">self</span>.<span class="var">gcn2</span> = <span class="clazz">GCNConv</span>(<span class="var">self</span>.<span class="var">hidden_dim</span>, <span class="var">self</span>.<span class="var">hidden_dim</span>)
        <span class="var">self</span>.<span class="var">fc</span> = <span class="clazz">nn</span>.<span class="clazz">Linear</span>(<span class="var">self</span>.<span class="var">hidden_dim</span>, <span class="var">self</span>.<span class="var">cls_num</span>)

        <span class="var">self</span>.<span class="var">relu</span> = <span class="clazz">nn</span>.<span class="clazz">ReLU</span>()
        <span class="var">self</span>.<span class="var"><span class="var"><span class="var">dropout</span>_<span class="var">layer</span></span></span> = <span class="clazz">nn</span>.<span class="clazz">Dropout</span>(<span class="var">self</span>.<span class="var">dropout</span>)


    <span class="reserved">def</span> <span class="method">forward</span>(<span class="var">self</span>, <span class="var">data</span>):
        <span class="var">node_feature</span>, <span class="var">edge_index</span>, <span class="var">batch</span> = <span class="var">data</span>.x, <span class="var">data</span>.<span class="var">edge_index</span>, <span class="var">data</span>.<span class="var">batch</span>

        <span class="annot"># GCN1</span>
        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var">gcn1</span>(<span class="var">node_feature</span>, <span class="var">edge_index</span>)
        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var">relu</span>(<span class="var">node_feature</span>)
        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var"><span class="var"><span class="var">dropout</span>_<span class="var">layer</span></span></span>(<span class="var">node_feature</span>)

        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var">gcn2</span>(<span class="var">node_feature</span>, <span class="var">edge_index</span>)
        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var">relu</span>(<span class="var">node_feature</span>)
        <span class="var">node_feature</span> = <span class="var">self</span>.<span class="var"><span class="var"><span class="var">dropout</span>_<span class="var">layer</span></span></span>(<span class="var">node_feature</span>)

        <span class="annot"># readout</span>
        <span class="var">node_feature</span> = <span class="method">global_mean_pool</span>(<span class="var">node_feature</span>, <span class="var">batch</span>)

        <span class="annot"># fc</span>
        <span class="var">output</span> = <span class="var">self</span>.<span class="var">fc</span>(<span class="var">node_feature</span>)

        <span class="return">return</span> <span class="var">output</span>, <span class="var">node_feature</span>
</code></pre>

                    <p>
                        <ul>
                            <li>9 ~ 19번째 줄: Graph Convolution 학습 레이어 구성하는 부분.</li>
                            <li>26 ~ 32번째 줄: GCN 거치는 부분.</li>
                            <li>35번째 줄: GCN에서 나온 결과를 그래프별로 하나의 특징으로 만들어주는 readout layer.</li>
                            <li>38번째 줄: 그래프 분류를 위한 fully-connected layer.</li>
                        </ul>

                    </p>


                    <div class="doubleSubHead">
                        <span style="display: block; text-align: center; margin-top: 150px;">&ldquo;</span>
                        <span>GCN 학습</span><br>
                        <span style="display: block; text-align: center; margin-top: 13px;">&rdquo;</span>
                    </div>
                    
                    <p>
                        이제는 구성한 GCN 모델을 바탕으로 코드를 학습하는 부분입니다.
                        아래 코드에 <span style="color:rgb(86, 155, 214);">self</span>. 이라고 나와있는 부분은 GitHub 코드에 보면 알겠지만 학습하는 코드가 class 내부의 변수이기 때문에 있는 것입니다.
                        여기서는 무시해도 좋습니다.
                        <br><br>그리고 아래 학습 코드는 실제 학습 코드를 간소화한 것입니다. Scheduler 등 전체 학습 코드는 <a href="https://github.com/ljm565/graph-classification-GCN" target="_blank"><span class="highlight" style="color: rgb(0, 3, 206);">GitHub 코드</span></a>를 참고하면 됩니다.
                    </p>


<pre><code class="python"><span class="var">self</span>.<span class="var">model</span> = <span class="clazz">GCN</span>(<span class="var">self</span>.<span class="var">config</span>, <span class="var">num_node_features</span>, <span class="var">cls_num</span>).<span class="method">to</span>(<span class="var">self</span>.<span class="var">device</span>)
<span class="var">self</span>.<span class="var">criterion</span> = <span class="clazz">nn</span>.<span class="clazz">CrossEntropyLoss</span>()
<span class="var">self</span>.<span class="var">optimizer</span> = <span class="clazz">optim</span>.<span class="clazz">Adam</span>(<span class="var">self</span>.<span class="var">model</span>.<span class="var">parameters</span>(), <span class="var">lr</span>=<span class="var">self</span>.<span class="var">lr</span>, <span class="var">weight_decay</span>=<span class="num">5e-4</span>)

<span class="return">for</span> <span class="var">epoch</span> <span class="return">in</span> <span class="clazz">range</span>(<span class="var">self</span>.<span class="var">epochs</span>):
    <span class="return">for</span> <span class="var">phase</span> <span class="return">in</span> [<span class="str">'train'</span>, <span class="str">'val'</span>]:
        <span class="return">if</span> <span class="var">phase</span> == <span class="str">'train'</span>:
            <span class="var">self</span>.<span class="var">model</span>.<span class="method">train</span>()
        <span class="return">else</span>:
            <span class="var">self</span>.<span class="var">model</span>.<span class="method">eval</span>()

        <span class="return">for</span> <span class="var">i</span>, <span class="var">data</span> <span class="return">in</span> <span class="clazz">enumerate</span>(<span class="var">self</span>.<span class="var">dataloaders</span>[<span class="var">phase</span>]):
            <span class="var"><span class="var">batch</span>_size</span> = <span class="var">data</span>.y.size(<span class="num">0</span>)
            <span class="var">data</span> = <span class="var">data</span>.<span class="method">to</span>(<span class="var">self</span>.<span class="var">device</span>)
            <span class="var">self</span>.<span class="var">optimizer</span>.<span class="method">zero_grad</span>()

            <span class="return">with</span> <span class="clazz">torch</span>.<span class="clazz">set_grad_enabled</span>(<span class="var">phase</span>==<span class="str">'train'</span>):
                <span class="var">output</span>, <span class="var">_</span> = <span class="var">self</span>.<span class="var">model</span>(<span class="var">data</span>)
                <span class="var">loss</span> = <span class="var">self</span>.<span class="var">criterion</span>(<span class="var">output</span>, <span class="var">data</span>.y)
                
                <span class="return">if</span> <span class="var">phase</span> == <span class="str">'train'</span>:
                    <span class="var">loss</span>.backward()
                    <span class="var">self</span>.<span class="var">optimizer</span>.<span class="method">step</span>()
</code></pre>

                    <p>
                        <span style="font-size: 20px;"><b>학습에 필요한 것들 선언</b></span>
                        <br>먼저 위에 코드에서 정의한 모델을 불러오고 학습에 필요한 loss function, optimizer 등을 선언하는 부분입니다.
                        <ul>
                            <li>1 ~ 3번째 줄: Loss function, 모델 및 optimizer 선언.</li>
                        </ul>

                        <br><span style="font-size: 20px;"><b>모델 학습</b></span>
                        <ul>
                            <li>5 ~ 23번째 줄: Cross entropy loss를 이용하여 모델 학습하는 부분.</li>
                        </ul>
                    </p>




                    <div class="doubleSubHead">
                        <span style="display: block; text-align: center; margin-top: 150px;">&ldquo;</span>
                        <span>학습 결과 및 특징 가시화</span><br>
                        <span style="display: block; text-align: center; margin-top: 13px;">&rdquo;</span>
                    </div>
                    <p>
                        이제 학습 loss, accuracy와 더불어 학습된 graph들의 feature를 t-SNE로 가시화해보겠습니다.
                        
                        <br><br><span style="font-size: 20px;"><b>Loss History</b></span>
                    </p>
                    <div class="contentImg">
                        <img src="https://lh3.googleusercontent.com/fife/AMPSemdPTWlt_irX8EJ_Wa_q-E_IyBBdYPRo1EacWpSefQqwOP1XJop0KUo_lNb51xX9uGKesUGuH6Geeox49uSAXj0kVg7HMAaDAfKV8Vl1lXDrI_qKe1c2cl5Ampm-nn8SVaYedmjJjLtysRUjiNTE3YsZ3CXWWbutCWPAl2NHWK4MhpWW1QMI3X495Kw3vYaEWrTnsOPjSUj06EAPykpYHyhraLTaxKfiw4URV4KaBIxxRhSti3aGdQ-jfXL6nlf1C6-4QXyUg4WfmCoymOMz6U1QMBYGiLNXCh-ngaXQ5yQWje3evKWS4IE48v2cB_jYGymRD2QZ_CzC9RP37IgujhGavH5xg4LpJKEEDQaFZ6ABC57c3GeaEr_fgiT7mX4TVzsSvbLpV6ISSUrVgn5CPxuzdAl-dsFC7fd6RooI1_Dy9MMlKGarBzleNrt1H1RBEnt4iFu-I9mFcrs_ucc4cgsnGilwWSg--RKzBZYnk--iKdvzRRM5wMs1lsiVwXVGGuIotB90OwSW21JHGBc9pxA1iBUM3TURcRhD79ZgsPpJb5ywW3R9qS4sa8HBxHJwsHly_wHMVWKoXxbFLOQQ0B-OE782_YO4KMkBe-0wFnQOdj3ecgavhv1oea4HKxZPd4tMJibEyc1sefzw8bxQKxWQXKxnevir4fOKonxGaJujNPon-NMplHHrg8hqmRVK_eanZzqfDp92_R5mfbyOxA7ep0OmMsY1KvP_9YswAw-N5D7nWC56xCTpq0HmuhLQi2t75hbLez13rBAqZMZycFB3rgyXWi6XahRJdVoOWMw5w1QJs_t41RY5NEWQ7WqvW_aV2xJgdI0ASlNJp08L9q6i1koya5uHfDiT8VleimkfWIwXQGC4YOnPLzZu4wivjfld3yz41P9EukOO7obCnzIrt0iE2u66oF0TnRLJ2ZuMskFNe97hasfQ0NTxFnMwzCUq_NTCrHTyjrxsQW34BIVXknND4iznam2d4KjsO6qsY-VyFCgw8S2cTd_hKVvjjM3dWQ6FK1wxbQ7BfyUVJEzffXsrkOyYcKHkbls4NspmXOKO_aUAQhZSuyjtHuq1fV-tiMK7Fg4uhchFui5jYWtQ3QFh98CUyw8ojhzp6IIG3yG-3dRWmIg9vVkJV0bxp6zJprOIL8GnE8g42y_Gc-yi8AZwB0hACC9u7k9MAm75Kbqise05HU4mk2Ig4JjOvjeVi6tBktYMA3Ja5JCeCmHP7yb3hlh0YMatzn9zXz1fFBfDlBL3nwpcwVbozZ2wsCZ5QpXL9VZKiIu8OzLJJIRmz15Dy79WRKHKNTf9j4upIJVNBbU4oXOirAx0j74VZJj98N-YRf0fto0yEti-tyGbbGmZMUu5pFVF0Qvkhz_VVd4koa2lXUSzKxF_16wH4KbVCwsDqchHW7r7nU81ror7DkvD5_IcOQ8-dCJ7dOnyFCDmziwGvxEYOe5vDruMuQaY4nSdUl2D_fLjdEDq9Wk" style="width: 100%;">
                        <p class="caption">Loss history</p>
                    </div>
                    
                    <p>
                        <br><span style="font-size: 20px;"><b>Accuracy History</b></span>
                    </p>
                    <div class="contentImg">
                        <img src="https://lh3.googleusercontent.com/fife/AMPSemdF4z81SPoDEPdai3c91R9hIGyuQggXyGxoFrlyDDTGWsQQ9IyK70sgcuGqOM048OPjGOodembmsdGFVJe1ARum58-3Cq9ShKip1qlk0RD_4-qniyRm0uzh_Msbwa8AU9L3OGsZlA45rmyv8EwIkGxg3OyoCJBUMCmgcXrzWIfFJEZ-0IOXhMzO85HFtu_z87KSsQA-oiZNUZh_xdqmy3qQNpv6YKqKip__RpSdPm_XGEb7rHTlGuBZprySccgMxLik_V8UC-ZmWzclNw3H875VUDAchEWGlkOQuVUGFU4KxzotKhlabIj80OUwzPkYs4rPzvlYBDFi2P8BGV3RWtTao8XVMhwFnrnjG-3nrGO11L-DrvT62IQyullgNIf729M9LTNG95UDpdyQNyRX1VUgtpJcTW6iQ5hnLrMWhdQdOhxv7t2Tav473zbwL3UM7njrH8uZHJJqcihSMV9_j6gcFPKMxC9i8Hq64vtRjkZzHee1V4KjPWWuq0elP3nZbrB4TyN7zcwwPWTqK8G-CgRtAKnVNZRHAzEZz_4Qq1g7XtJN1Bg9P5agpfTvBLCWtXNYi68A-xJdOsNajzag873FV9Z2Amgf_zbc13i4B4jEvkwdwO9XcMfnr8yK2Zcf-yohFKbCgTd0TV0BsnQMpPUpk83mVslMuAW3Lqe96JXrAHYm1_wGNZmDJqqojUD6gWWzac0qCaiBh1iIbVHywKPpkccbxdBMlKYMYXe0iC3Wdd_MtK9W_02HU_D0xJ8yQe3jpfmY03CbNVSff_tg3hQJQM955Su4VQk34RTcjdAA3fEJYnd6cRgNdhD5nJKnkSddRbIrf6L1JiXW_6r-iMBnUVgM-wnkVxXQVuD-KS47UqZMZtwHL4lzA74eidu14zbIJ1JIRhZIEAG9y1cXiC9WnkW-6RkVBtQbo0v24OCRufbevgKb44CzkbuEpuUNYMgTVedfMcCvmLhmbi-tmGPz_NKrUCpqUl_AhVK4DDIDBti7oRfkpmokH8cu8543XPzjCNZ6D7B-CZnA1GZzX1p9k4-kaxbzud6Ug73sQ0EfXyP89jT-oOQVjF66IbVd7zjEG2ZsB3FTzoSsxuECrlrDv0uNg4dev7WDMg2lZG5kNWzSKCTC2yLDB7wpPMK-uDdKJH0JE9_OcrfeaiPRWu64nMqmdyrtvXxiCJPO38RAS2JwyynYF91iJ4SHl8Wi5no53whR-u6H96YN89TWPxOJYPpScmK7fk_uxNw61NOEdgOjAAtIaoVhJdgLJaPd08XbGKoIyHsOj_gRSkWPG8qlu1CMhGjjGzzzpYE5pFPbbgqz_T8d7eO09n2HdbdLy2_n3-zre1KMoLKHUjt1GkBPk5G1ovxJo64Jdzr8G-RI3XabR78iShY6ciOUQrRpKysv3KTKN0ZUoUKh4yLS0zxUqWVfk2y0Ul-wDpW9XFlFZ6hvWgwtLIBNFbOgH-0joTS8PYTRKWEtfYDzaYLXmRM" style="width: 100%;">
                        <p class="caption">Predicted graph label accuracy history</p>
                    </div>
                    
                    <p>
                        <br>아래 결과는 validation set의 가장 높은 accuracy를 달성했을 때 모델의 test set 결과입니다.
                        <ul>
                            <li>Accuracy: 0.7907</li>
                        </ul>


                        <br><br><span style="font-size: 20px;"><b>Graph Feature Visualization</b></span>
                        <br>아래는 test set의 실제 label과 예측한 label을 바탕으로 학습된 그래프들의 특징을 t-SNE로 가시화한 그림입니다.
                    </p>
                    <div class="contentImg">
                        <img src="https://lh3.googleusercontent.com/fife/AMPSemfAIlO91-AOZeuZkPgARkThsWqfcFq-Y6kDl5CXdKnYdF56UqEGytLISh2kXPF8q2k-pswKpAYovHaySOHVLbRCP-b1Fk89ArMyDt-yuejupC5kJEaZDyg18dBH7DQgkqi9NTFnVPubBSmKznR3fUKWLRwA__HtOO56SR8HtdS0FDjK3KEhP9RybTRd-fe9xb2PWOYold30eD_YmVFrybLmDqZbk6XzglX46egMZI6TTa41NsFIJqW8a0s5GU9I-QNuL0Xuj0vOC7jcLL_wxl_RJzf27Ar-mioLNlyXdL_zlTwVAuoN0uV2_Sy83uAIwRAJ_j5SeN5mAA9PvWOlVLoaGNfqgzUWLXBNxyzUE3uC7o2KWtzRXlw-0bHbSJDj1_JNTufpGNzDi46GotF_B3f-O4IihwS6pU0_x8kB_ccOkIW0v6PT0sSc-XWaaBYmAs5Qdgj6gXQSpBu2_n05QhosupE0yAxvFpjSKsxHSlBVxlrtpyCtLKX3aUG5by0q7XhNzlr6-j3Q0y9pZ24e1T7E52_4OSWpQmUQl74Zu64up_gHFn8rN49E0NwBxgF3D-01mnEsnU5aMDz01sJyfqgpIxrFpnTEch_5kMw_BnzoaPUFP3D-yMjOu3Nv9Ca7AGc_pVNAPhmt2GNxIVQYwilRrcvP5cH2c22NqqBzobcwV_HUmUAtZrsofuPR_f-cHsfb3DTXYWKgh4C2HrMlitbko6DzBF-CjULiPTKJpt2OATYN1fGSQAJl2BGN9i3ZJhLzA_YlH4UAsa84VtGAFRqRVSRjozLEekLUr1j_pb8PsloLJ0T_5J0AbeBsMmr_I36jNQtLEuQv6m9PiciaRvPLSBXo0769iSZPI-RXx5ODR5S1mL2wzOFflA_-f_fEhol0HhCAQWDq6H-8fK2a6OMMpUlg6P-ElRWA8-KaRff-wGrtMNt9xvp-b5Q_3MWbiwD4TF67lWxkQVwl8ZYKCTmEJF6l6wLHRKv_L7IIls1lL9aVhvmK_V9lwhVgkI3KfhlzndPkhEpV-s_lTnYY-HTSyhk39W0_PhIV5H1hAv3GabT-4PuyZl4yBzAMHHwukk1VGVxzDOQkVVvwZJoR416mBB-z1kZZ7Xhwq5yAmfYBmEm2U2toiFAZgA90rfwDuuZgt6SumX8XNN-OZh1LPOpS11Rs65X0T-3SOchgibzjFryBNEbzy2HzJvIK73FfAeGqNlfRYGp7eX4cSBttwq8zZwz2PEkKmGX5yBeyIg-0qCOK-EyBFeqITG4I7SK5PUe9o2fE_w_jEoEex-DQQf900PtN9DsOxuo9MywHXjjilxsKr5grKEo-JSR0C3LpmZUv7HsgGaMHp0rEJWOgpf6M4Tbe59ywUJydKzUDFRKp65w2oSuT7zhEG9P9qlw7UmzuNCzt9Z1cpYYczbG6qN6TRUI40gXm56wJHrR48tLr6XrZBJisbLMD_jdu_CIWgfaG7X_Tw76eV1hREmqlYWw" style="width: 100%;">
                        <p class="caption">Graph feature visualization</p>
                    </div>
                                       
                    <p>
                        <br><br><br>그래프를 이용하는 딥러닝 알고리즘의 연구는 현재까지 활발히 이루어지고 있습니다.
                        사실 모든 데이터는 그래프로 볼 수 있기 때문에 이렇게 다양한 활용이 나오는 것 아닌가싶습니다.
                        이렇게 간단한 튜토리얼 이외에도 기회가 된다면 다른 GNN 알고리즘을 이어서 다루어보도록 하겠습니다.
                    </p>

                    
                </div> 
                <div class="tag">
                    <b>태그</b>&emsp;#GCN&emsp;#TUDataset&emsp;#COLLAB&emsp;#GraphConvolutionalNetwork
                </div>
                <div class="pageTurner">
                    <div class="pageTurnerLeft">
                        <span><a style="position: absolute; left: 0;" onclick="pjaxPage('gnn2.html');" onmouseover="colorOn(this);" onmouseout="colorOff(this);">&lang; 이전글</a>
                        <br>Cora 데이터와 GCN을 이용한 노드 분류</span>
                    </div>
                    <div class="pageTurnerRight">
                        <span><a style="position: absolute; right: 0;" onclick="alert('GNN, GCN 마지막 게시물 입니다.\n\nThis is the last post of GNN and GCN.')" onmouseover="colorOn(this);" onmouseout="colorOff(this);">다음글 &rang;</a>
                        <br></span>
                    </div>
                </div>
                <span id="readNum"></span>
                <div id="disqus_thread"></div>

                <script>
                    headHighlightColorChanger();
                    (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://novicetraveler.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    })(); 
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </article>
        </div>

        <div id="menuRelated">
            <div class="menuButton">
                <img id="menuImg" src="init/index_img/menu_black.png" onclick="openMenu(this);">
            </div>
            <div class="menu">
                <img id="menuExtension" title="메뉴를 확장합니다." src="init/index_img/extension_black.png" onclick="extendMenu(this);">
                <div class="profile">
                </div>
                <ul class="tree">
                </ul>
                <p class="copyrights">
                    © 2022. 여행 초짜. All rights reserved.
                </p>
            </div>
            <div class="bigMenu">
                <img id="menuCompression" title="메뉴를 축소합니다." src="init/index_img/compression_black.png" onclick="compressMenu(this);">
                <div class="profile">
                </div>
                <ul class="tree">
                </ul>
                <p class="copyrights">
                    © 2022. 여행 초짜. All rights reserved.
                </p>
            </div>
        </div>

        <script>
            detectScroll();
            pushFunc();
            detectSize();
        </script>
    </body>
</html>